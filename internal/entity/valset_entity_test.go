package entity

import (
	"encoding/hex"
	"fmt"
	"math/big"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestValidatorSetHeaderEncode(t *testing.T) {
	v := ValidatorSetHeader{
		Version: 1,
		ActiveAggregatedKeys: []Key{{
			Tag:     15,
			Payload: decodeHex(t, "264621561abeb4dac9a497cb21f305b8f41b56389734832656d7c7adde2247081ffa73b25b82c16096babd6a15d259a24a8304cd96ee6c27e790ff27d8744a5b"),
		}},
		TotalActiveVotingPower: new(big.Int).SetInt64(30000000000000),
		ValidatorsSszMRoot:     [32]byte(decodeHex(t, "d9354a3cf52fba5126422c86d35db53d566d46f9208faa86c7b9155d7dcf3926")),
		ExtraData:              decodeHex(t, "2695ed079545bb906f5868716071ab237e36d04fdc1aa07b06bd98c81185067d"),
	}

	encode, err := v.Encode()
	require.NoError(t, err)
	fmt.Println(hex.EncodeToString(encode)) // TODO remove

	hash, err := v.Hash()
	require.NoError(t, err)
	fmt.Println(hex.EncodeToString(hash)) // TODO remove

	hexFromContract := "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000001b48eb57e000d9354a3cf52fba5126422c86d35db53d566d46f9208faa86c7b9155d7dcf3926000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000040264621561abeb4dac9a497cb21f305b8f41b56389734832656d7c7adde2247081ffa73b25b82c16096babd6a15d259a24a8304cd96ee6c27e790ff27d8744a5b00000000000000000000000000000000000000000000000000000000000000202695ed079545bb906f5868716071ab237e36d04fdc1aa07b06bd98c81185067d"
	hexHashFromContract := "73478c5851ab1d5c63e448c82d9216314bb9458d8ef04655537518c48bd1ca09"

	require.Equal(t, hexFromContract, hex.EncodeToString(encode))
	require.Equal(t, hexHashFromContract, hex.EncodeToString(hash))
}

func decodeHex(t *testing.T, s string) []byte {
	b, err := hex.DecodeString(s)
	require.NoError(t, err)
	return b
}
